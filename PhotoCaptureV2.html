<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ID Photo Booth</title>
<style>
  body{margin:0;font-family:sans-serif;background:#f3f4f6;}
  h2{text-align:center;margin:12px 0;}
  .wrap{display:flex;justify-content:center;gap:30px;padding:20px;flex-wrap:wrap;}

  /* Left column */
  .camera-col{width:340px;display:flex;flex-direction:column;gap:10px;align-items:center}
  video{width:100%;aspect-ratio:7/9;background:#000;border-radius:8px;object-fit:cover}
  select,input,button{width:100%;padding:8px;font-size:16px;border-radius:6px}
  button{cursor:pointer;border:none}
  #snap{background:#2563eb;color:#fff}
  #download{background:#16a34a;color:#fff;margin-top:8px;display:none}

  /* Card (right) */
  .card{
    width:350px;
    height:450px;
    position:relative;
    overflow:hidden;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,.25);
    background:#000;
  }
  #shot{
    position:absolute;
    top:0;left:0;
    width:100%;
    height:100%;
    object-fit:cover;
    display:none;
  }
  .label{
    position:absolute;
    bottom:12px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(255,255,255,0.85);
    padding:4px 10px;
    border-radius:4px;
    font-size:18px;
    font-weight:bold;
  }
</style>
</head>
<body>

<h2>Take Photo for ID</h2>

<div class="wrap">
  <!-- LEFT -->
  <div class="camera-col">
    <select id="cameraSelect"></select>
    <video id="video" autoplay playsinline muted></video>
    <input id="sid" placeholder="Enter ID">
    <button id="snap">Take Photo</button>
  </div>

  <!-- RIGHT -->
  <div>
    <div class="card" id="card">
      <img id="shot" alt="photo">
      <div id="label" class="label"></div>
    </div>
    <button id="download">Download</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
const video=document.getElementById('video');
const sid=document.getElementById('sid');
const shot=document.getElementById('shot');
const label=document.getElementById('label');
const snap=document.getElementById('snap');
const card=document.getElementById('card');
const dl=document.getElementById('download');
const cameraSelect=document.getElementById('cameraSelect');
let currentStream;

// list available cameras
async function listCameras() {
  const devices = await navigator.mediaDevices.enumerateDevices();
  cameraSelect.innerHTML = '';
  devices.forEach(device => {
    if (device.kind === 'videoinput') {
      const option = document.createElement('option');
      option.value = device.deviceId;
      option.text = device.label || `Camera ${cameraSelect.length+1}`;
      cameraSelect.appendChild(option);
    }
  });
}

// start camera by deviceId
async function startCamera(deviceId) {
  if (currentStream) {
    currentStream.getTracks().forEach(track => track.stop());
  }
  const constraints = {
    video: { deviceId: deviceId ? { exact: deviceId } : undefined }
  };
  const stream = await navigator.mediaDevices.getUserMedia(constraints);
  currentStream = stream;
  video.srcObject = stream;
}

// when dropdown changes
cameraSelect.onchange = () => startCamera(cameraSelect.value);

// init on load
(async()=>{
  await listCameras();
  if (cameraSelect.options.length > 0) {
    await startCamera(cameraSelect.value);
  }
})();

// update ID
sid.addEventListener('input',()=>label.textContent='ID: '+sid.value);

// take photo (passport size, no stretching)
snap.onclick=()=>{
  const vw = video.videoWidth;
  const vh = video.videoHeight;
  const aspect = 7/9; // passport ratio

  let cropW = vw;
  let cropH = vw / aspect;
  if (cropH > vh) {
    cropH = vh;
    cropW = vh * aspect;
  }
  const sx = (vw - cropW) / 2;
  const sy = (vh - cropH) / 2;

  const canvas = document.createElement('canvas');
  canvas.width = 350;
  canvas.height = 450;
  const ctx = canvas.getContext('2d');

  ctx.drawImage(video, sx, sy, cropW, cropH, 0, 0, canvas.width, canvas.height);

  shot.src = canvas.toDataURL('image/png');
  shot.style.display = 'block';
  dl.style.display = 'block';
};

// download card
dl.onclick=()=>{
  html2canvas(card,{
    backgroundColor:null,
    scale:3,
    useCORS:true
  }).then(cv=>{
    const a=document.createElement('a');
    a.download='id-card.png';
    a.href=cv.toDataURL('image/png');
    a.click();
  });
};
</script>
</body>
</html>
